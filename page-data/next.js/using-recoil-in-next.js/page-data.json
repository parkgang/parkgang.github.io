{"componentChunkName":"component---src-templates-blog-post-js","path":"/next.js/using-recoil-in-next.js/","result":{"data":{"site":{"siteMetadata":{"title":"Parkgang Dev Log","author":"parkgang","siteUrl":"https://parkgang.github.io","comment":{"disqusShortName":"","utterances":"parkgang/parkgang.github.io"},"sponsor":{"buyMeACoffeeId":"parkgang"}}},"markdownRemark":{"id":"7f3b34f3-31c4-5fd1-ad93-9e85bd3f2d97","excerpt":"Intro 이번 글에서는 next.js에서 recoil를 사용하는 방법을 가이드 하도록 하겠습니다. 원래는 redux를 사용했었지만 기본적으로 필요로하는 코드의 양이 많아 내가 원하는 상태를 빠르게 저장하고 빼서 쓰고 싶었는데 개발하면서 딜레이가 생기는 경험이 있었습니다. 물론 지금은 redux toolkit이 나와서 많이 해소 된거 같지만 facebook이 직접 개발하는 recoil이 앞으로 더 발전가능성이 높아서 사용하게 되었습니다. recoil를 CSR에서는 사용해 보았지만 next.js…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABcSAAAXEgFnn9JSAAACf0lEQVQ4y3WTzU8TQRjGd/aju7PdQtfd7raw7XapbUEKpUCoYhShEawtAgeJHzFB/DgQ48GziaIJF48GT8aDiVcPqAcvXokeTLyb+I/gPE4/rSCHZ2fe9332N+/MZARBEH5zHfRKJP/GDZH2KBNyEKHqgSCSI562BPxfBCnPgx93QVW1m8/3RxDVNehuFMFQgKSXhMd9tm13PM0P60gSBXYmqzFNEZjjJVn2co2phsEkXltLDzIqikxQROaczTMn4TLbsphpmszgnjajBSTtDixDxM+XaZTTEgTDhv3mLYSoiXk7il/XqjC4J1zwMLV7+5idHQKmbAUDpgzfkuHEdNB0BgHf4oRlIhMJI+Bq+GjChGJoLQjpARIeyGKzVX42EgIn1C2W8gmcKw5B53O/DXKoBj9Mm3N9wGx5RXK0w8Y4FFeaSUUSkeELuaYFPSKhnDRgKn8XSmgUTojHUf0wDIJvy9i9a7EX6y7iRgj9/Mc878BeXALd3kFsdAzFfhVjaYrlsoOV2QTcEyEMqhpSVh8KW4vwN85Dou0FPz+OA3uj7MnyDK5PTSKrypCHRxDd/47lj5+ABzfwanoc1XIM1bkJFAsjqM16GAiruDpZwsatKupfn8PfvNACfnmaAN6fYo9qZayVZ6DxZIh3ZX37gdW9Dxx4E69Pl3CJA5fmprGwUEGdA+N6CEuTU7izuYr6/jaC+5UW8CQ/t3cPHba94sCQlO5ZhGtX0PdsB15htBVTgvpMDOvzafiu3szFwxpK9yoIti5C7tx476UcliFJyGVzGC8Wkc0NI5PJdGuEHPPCGgX+dplIjhRARAmUUuhcmqZBbT5Bnu/xEe5reDvxH7RHToHgmyXgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/03a7ff0361001edec9d6948c39788233/c1b63/1.png\"\n        srcset=\"/static/03a7ff0361001edec9d6948c39788233/5a46d/1.png 300w,\n/static/03a7ff0361001edec9d6948c39788233/0a47e/1.png 600w,\n/static/03a7ff0361001edec9d6948c39788233/c1b63/1.png 1200w,\n/static/03a7ff0361001edec9d6948c39788233/52576/1.png 1412w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h1 id=\"intro\" style=\"position:relative;\"><a href=\"#intro\" aria-label=\"intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Intro</h1>\n<p>이번 글에서는 next.js에서 recoil를 사용하는 방법을 가이드 하도록 하겠습니다.</p>\n<p>원래는 redux를 사용했었지만 기본적으로 필요로하는 코드의 양이 많아 내가 원하는 상태를 빠르게 저장하고 빼서 쓰고 싶었는데 개발하면서 딜레이가 생기는 경험이 있었습니다.</p>\n<p>물론 지금은 redux toolkit이 나와서 많이 해소 된거 같지만 facebook이 직접 개발하는 recoil이 앞으로 더 발전가능성이 높아서 사용하게 되었습니다.</p>\n<p>recoil를 CSR에서는 사용해 보았지만 next.js와 같은 SSR에서 사용한 사례를 찾기는 어렵더군요</p>\n<blockquote>\n<p>아직 공식 릴리즈도 안된 라이브러리 이니…</p>\n</blockquote>\n<p>next.js는 SSR를 지원하기 때문에 각각의 페이지 별로 정적파일이 생성되어 CSR과 햇갈릴 수 있습니다. 하지만 사용하면서 크게 다른 점은 없습니다.</p>\n<p><strong>기본적으로 CSR과 SSR의 차이, next.js와 recoil에 대해 기본적인 이해를 기반하고 설명합니다.</strong></p>\n<h1 id=\"프로젝트를-생성해보자\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EC%83%9D%EC%84%B1%ED%95%B4%EB%B3%B4%EC%9E%90\" aria-label=\"프로젝트를 생성해보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프로젝트를 생성해보자</h1>\n<blockquote>\n<p>해당 실습이 진행된 코드는 아래의 링크에서 확인하실 수 있습니다.<br>\n<a href=\"https://github.com/parkgang/next.js-with-recoil\">parkgang/next.js-with-recoil</a></p>\n</blockquote>\n<p>먼저 아래의 명령어로 next.js 프로젝트를 실행하도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">npx create-next-app</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVQY043QS0sCURQA4JPaaI8B5w7lM4OeoFJkatqkKZmPHKcmX2im9iQLylW49eKudf+hfYv+hT9EuPQHitPFoHUHvvNYnLM48AwAVQBL0A7ECUAcXNnnIt3qOXnQj8mtmieX2Szploqk16iTu4JGrsNLpOICwlf/JNdWzc3dKAAOP6BTPnnVrlpfAe1ipOg3TNHqLJLKsL2sxqKHKts5yLFgMsPrEQsl0yx22mZK+Z7ptSZrtZujYrX2HVASL82nHj+ICP509t1b6eCi3sH16iPOp0ooR2JoDSdQDMbHVdiIoMEXQvBuoxBR0bxfw83iGcbqDfQXiihvRd/yw08AN8AEiJJqlOWBSZL6RquVTtkcVPQsU7NjgQp2N7U4PNTi5PhsmHNSsEoURJGCMEvBNNOHaWlgkm0ZGMdKAHwABt5NcsJ/8CSYOf4xIcfFf3cNQkyFHzXGYODQD9R2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/afcdbbec8e96d254f2d5db6a47aca9d8/c1b63/2.png\"\n        srcset=\"/static/afcdbbec8e96d254f2d5db6a47aca9d8/5a46d/2.png 300w,\n/static/afcdbbec8e96d254f2d5db6a47aca9d8/0a47e/2.png 600w,\n/static/afcdbbec8e96d254f2d5db6a47aca9d8/c1b63/2.png 1200w,\n/static/afcdbbec8e96d254f2d5db6a47aca9d8/f02b9/2.png 1554w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<blockquote>\n<p>공식으로 제공하는 <a href=\"https://github.com/vercel/next.js/tree/canary/examples/with-recoil\">with-recoil</a> 템플릿이 있었지만 마지막 업데이트가 거즘 8개월 전이고 recoil 버전 업도 많이 된 상태이기 때문에 사용하지 않았습니다.</p>\n</blockquote>\n<h1 id=\"recoil를-추가하자\" style=\"position:relative;\"><a href=\"#recoil%EB%A5%BC-%EC%B6%94%EA%B0%80%ED%95%98%EC%9E%90\" aria-label=\"recoil를 추가하자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>recoil를 추가하자</h1>\n<p>아래의 명령어로 next.js 프로젝트에 recoil를 추가해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> i recoil</code></pre></div>\n<blockquote>\n<p>next.js는 pages 별로 정적 파일을 찍어낼 텐데 어떻게 하나의 상태 관리를 할 수 있을까요?</p>\n</blockquote>\n<p>정답은 <code class=\"language-text\">_app.js</code> 에 있습니다. next.js의 모든 pages는 렌더링을 거치기 전에 <code class=\"language-text\">/_app.js</code> 를 거칩니다.</p>\n<p>우리가 recoil를 사용할 때 recoil 상태를 사용하는 컴포넌트의 최상위 부모 트리에 <code class=\"language-text\">&lt;RecoilRoot></code> 가 필요한데 해당 파일에 wrap 해주면 됩니다.</p>\n<h2 id=\"기본적인-_appjs-구조\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-_appjs-%EA%B5%AC%EC%A1%B0\" aria-label=\"기본적인 _appjs 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본적인 _app.js 구조</h2>\n<p>여기서 <code class=\"language-text\">Component</code> 는 각 pages component가 들어오고, <code class=\"language-text\">pageProps</code> 는 getInitialProps를 통해 들어온 props들을 나타냅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>Component <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MyApp</code></pre></div>\n<h2 id=\"recoilroot-적용\" style=\"position:relative;\"><a href=\"#recoilroot-%EC%A0%81%EC%9A%A9\" aria-label=\"recoilroot 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RecoilRoot 적용</h2>\n<p>여기에 Component 코드를 <code class=\"language-text\">RecoilRoot</code> 로 wrap 해주면 됩니다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> RecoilRoot <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token operator\">&lt;</span>RecoilRoot<span class=\"token operator\">></span></span>      <span class=\"token operator\">&lt;</span>Component <span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>RecoilRoot<span class=\"token operator\">></span></span>  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> MyApp</code></pre></div>\n<h1 id=\"기본적인-상태관리-방법은\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-%EC%83%81%ED%83%9C%EA%B4%80%EB%A6%AC-%EB%B0%A9%EB%B2%95%EC%9D%80\" aria-label=\"기본적인 상태관리 방법은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본적인 상태관리 방법은?</h1>\n<p>자, 아직 남은 문제가 있지만 기본적인 recoil를 사용할 수 있는 상태까지 왔습니다.</p>\n<h2 id=\"테스트를-해보자\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8%EB%A5%BC-%ED%95%B4%EB%B3%B4%EC%9E%90\" aria-label=\"테스트를 해보자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트를 해보자!</h2>\n<p>일단 잘 작동하는지 테스트를 해볼까요? <code class=\"language-text\">/states</code> 디렉터리를 생성하고 내부에 <code class=\"language-text\">index.js</code>를 생성해 봅시다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 224px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 102.67857142857142%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACV0lEQVQ4y5VV227TQBDNO+IFCYrv9tppbeJLYjtpKkQb2tzqphTeUAEBQpX6CXwKfzvMzMaXOC4tD0fjHXvPzu2se+JoDPHkAlQzAt0eguGM8DkGxQjZ10SXr/nOFCn0iED4U3ZqVoKkSfVBG01/+4CK0PJDSN6OOToiNByyMa9lxBJ0UDvCTkLdjcDPprxBEtW2hjysTdDOhAkDJ4bzeAI6pq47GRgiZ/s/KWt4YEXoWQN4F2bcjJJQs0fbSMJ/NqUitOKa8MXhCTzPr8HA1Mhheznbp3S1M+VXtDl+zxESyEk1e4jo0bHR+lMQecHFbxJ21fC1PuiEYkhrihFGaI9BC9e8sN2MU7bQUl0IcuBlp8lvuemDcPpj6F3OBPz5/QzexGdw9fEeips7WBY/2BYf7mDz6R5mi1tYb37B+GQD6eSyE9lxAYNkBr1J7sPtjQ5+eAqrq5+wKL7DxeorzNff4Hz5hX1n88+8HuYrSLIFYrm1NYb5EoLoFGuoRSAOZI1kihLlKLxUjuBAC+BADUDBMWLszWejy7YVwsAOmMRysX4iY2s4KTdJMaIaenvAO8ZGcyIwA5JaDKYrYXk4kwhD4HN/KNduwpZ8baUYImkQ2kjYx04isdVPmNBG6xxSZ9HnlQcl/H6XUKqJvtuJ0PK3VxdKT0LqWbelHEmKcg7Dzgui1L4kxBqaXoCbSsIR69lwiTRlaJVywj3ZScJRTah6x6Cm19yAcnDpBT2X92HzLuyyO01RMRI1mvMmcpQgwvIQIn3sl1ARkg4VnLN97Q527FP/KX8B+yZfXn5xBY8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/1e53c175168eadadc280bcbb23dfb0e3/80b2d/3.png\"\n        srcset=\"/static/1e53c175168eadadc280bcbb23dfb0e3/80b2d/3.png 224w\"\n        sizes=\"(max-width: 224px) 100vw, 224px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>해당 파일에 아래의 코드를 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> atom <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageNameState <span class=\"token operator\">=</span> <span class=\"token function\">atom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">'pageNameState'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">/pages/index.js</code> 의 코드를 아래와 같이 변경합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRecoilState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> pageNameState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../states'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">IndexPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>pageName<span class=\"token punctuation\">,</span> setPageName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useRecoilState</span><span class=\"token punctuation\">(</span>pageNameState<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Index Page<span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>pageName 상태<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>pageName<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>button\n          onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setPageName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IndexPage'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">></span>\n          현재 페이지 이름으로 상태 변경\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> IndexPage</code></pre></div>\n<p>router 되더라도 상태가 유지되는게 핵심이겟죠? 다른 pages도 만들어 봅시다.</p>\n<p><code class=\"language-text\">/pages/post.js</code> 를 생성하고 아래와 같이 코딩합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Link <span class=\"token keyword\">from</span> <span class=\"token string\">'next/link'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRecoilState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> pageNameState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../states'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">PostPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>pageName<span class=\"token punctuation\">,</span> setPageName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useRecoilState</span><span class=\"token punctuation\">(</span>pageNameState<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Post Page<span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>pageName 상태<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>pageName<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>button\n          onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setPageName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PostPage'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">></span>\n          현재 페이지 이름으로 상태 변경\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Link href<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>button<span class=\"token operator\">></span>Index Pages 이동<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> PostPage</code></pre></div>\n<p><code class=\"language-text\">post</code> 페이지로 이동하기 쉽게 <code class=\"language-text\">/pages/index.js</code> 에 아래의 코드를 추가합니다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> Link <span class=\"token keyword\">from</span> <span class=\"token string\">'next/link'</span></span><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRecoilState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> pageNameState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../states'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">IndexPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>pageName<span class=\"token punctuation\">,</span> setPageName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useRecoilState</span><span class=\"token punctuation\">(</span>pageNameState<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Index Page<span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>pageName 상태<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>pageName<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>button\n          onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setPageName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'IndexPage'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">></span>\n          현재 페이지 이름으로 상태 변경\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token operator\">&lt;</span>Link href<span class=\"token operator\">=</span><span class=\"token string\">\"/post\"</span><span class=\"token operator\">></span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token operator\">&lt;</span>button<span class=\"token operator\">></span>Post Pages 이동<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span></span>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> IndexPage</code></pre></div>\n<h2 id=\"테스트-결과\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B2%B0%EA%B3%BC\" aria-label=\"테스트 결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 결과</h2>\n<p>next.js를 실행해보면 index page에서 변경된 상태가 post page까지 잘 전달되는 것을 볼 수 있습니다. 그 반대도 마찬가지 입니다.<br>\n이로써 recoil이 정상적으로 동작하는 것을 확인하였습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC90lEQVQ4y6WSXUhTYRjHH0NvusqoXOp0Mzc/5tzmcR9ufmzza1NzOm1Oq9nFQLBcNOhGMKQtSS+8ECSDboYX5oEchRAGgaGwG1FvuqibiUkzULeuhJ2d8/SeTbQP+pAe+HFeznmf3/N/zzkAZ4UAWRII2urg+ZtqKLrdCFOPn8HLV6/h3dsVWFkOweiDR+B/OA7TU0/Be/c+6NQ6KC6SQY6wEHJFUrjR74bsnDw4l3kB4LJUAZkCIaUvKX5RoZHM55dKaUU5RVOUhq5Ua2m1RkeXyZW0nKBUUnRpqZwWFxTSIlEBLcwTEcS0rEwxfynrsqRQUgJg7uwHQa5o0CAvR7WmDEtVSjQYjNjY3IbNVhs2NLUipTGgiqDW1SClrsJimQIlRTIkIiRDUKMzoECQ3VldWw+AiCCVFt+pqjMjpa+J1zY2MSZzE6PU1jBUtZExNFiYqtp6RlFeycjKKEalr2dU2lpGqTYwdvs1prvDHtfqqlEozHeM+iZTQkVFpafD7ULToIM1DTk5Z+91tHb3od7WjpZbN7GvpxftlBa7mtrR6BjE1nYnGk2N2Ha1g+vscrA2WxeKxVd6pp8EUsLJyUnPVngLdz7tsNtb21w4HMbI5wh+2d3Fr7EYxqIxPIiliB3sYzR6QCDrWIyLRqPs3t4ejoyM9PCupNDr9XoWFxdxIbjArq2tccFgEOfm5jASieBfiiOw/GJsbOxEODMz49nf30cyiT2ampTxk+PxOHIchyzLJq8/wRebSCTQ7/efCIeHhz1LS0u4vLzMEjiSEldXV3FjYwP5zckoHPdrvNRNlh/2g3BiYsKzubmJ6+vrLIHj0x0eHiLDML+V/VE4OzvrOdrDHr2X75tOnzAQCAzxRyMPGPaURZwJ/iQ+n89xLCRf9B7+Z42Pj/ceC8k/1E0+xIdQKMTz8bSQ3vdut7s+KbRYLGkAcJGgIZgIxlPC91CE8wMDA2nJhHa7/YzT6Uwn8gyr1frPtLS0ZPA9Lpcr3Ww2p/Gub8jtJEJbhiKqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"4\"\n        src=\"/static/4e8c97a7f3396d70c5df4acff2557850/c1b63/4.png\"\n        srcset=\"/static/4e8c97a7f3396d70c5df4acff2557850/5a46d/4.png 300w,\n/static/4e8c97a7f3396d70c5df4acff2557850/0a47e/4.png 600w,\n/static/4e8c97a7f3396d70c5df4acff2557850/c1b63/4.png 1200w,\n/static/4e8c97a7f3396d70c5df4acff2557850/d9b5d/4.png 1224w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC90lEQVQ4y6WSXUhTYRiAX0Nvusqo/J1u5qZuzm2e/bnp3CaTbfm3aXNKaRcDwWpR0I1gCOpIhC4KCSIvhhfmAQnKixSGMy+8ETUoosgLwQmi+8kbYcdz3r4zRfuhUHrh4fvOOd/7vO/3cgDOCwCyxPC6uRZezVVDyW0bPH38Et68fQehuTB8/PAZ6MlpGHg0DGPPXsCDew9Br9FDaYkM8gTFkC+UwI1uH+TmFcCFzEsAORIFZGYLKENZ6XSlVjxVKJXQigqKpigtrVbraJ3eQKsq1bRcrqSVSoqWSuW0qKiYFgqLaEGBkCCiZeWKqStZOeJicRmA1dUN2fnCXqO8AjXacpSqlGg0mtFmb8B6eyM6G1xotTlRqTagpsqElKYKS2UKFJfIkIiQFEGt3ojZ2bmualMdACKCRFJ6R19rRcpQkzTZbIzFWs8odTWMutrCGOvsjI6sSoWakckpRmWoY1Q6E6PUGBm3+zrT1uJO6vTVKBAUegYGnxwKVWqN3+XrRnOvh7X6O7h2byc62jqxqqkRHbduYid5dlM6bK1vQrOnF681edFssWFDYwvnavWwzc2tKBJdbR97HjwUDgcC/vVv67gV2WLJykUiEdzcjGAsGsPv8QQmCLHEIYlYFOPxGIHsEwkuHo+zu7u72N/f3867UkI/iZmZGQyFQuzC+wVuYmICw+EwniI4AstvAoHAiXB8fNxPKmE0GmX39va47e1t3NnZSZFMJpHjOGRZNrX+Bh/swcEBDg0NnQj7+vr8s7OzOD8/zxK45eVlXFxcxNXVVeQPp1rhuD/bO3zJ8sV+EY6OjvrX1tZwZWWFJTJuY2MD9/f3kWGYv8r+KSQz8x+dYY/m8nPS2TsMBoN3+auRDwx7xiDOA/4mg4ODnmPh5OTkffzPGBkZ6TgWkn+ojczuy9LSEs/Xs0JyP/l8vrqU0G63pwHAZYKWYCGYzwifQxEu9vT0pKU6dLvd57xebzqRZzgcjlPjdDoz+Jyurq50q9Waxrt+ADFiJYPWyXuhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5\"\n        title=\"5\"\n        src=\"/static/5efa1ff72ed2828068a74bc96a6349b4/c1b63/5.png\"\n        srcset=\"/static/5efa1ff72ed2828068a74bc96a6349b4/5a46d/5.png 300w,\n/static/5efa1ff72ed2828068a74bc96a6349b4/0a47e/5.png 600w,\n/static/5efa1ff72ed2828068a74bc96a6349b4/c1b63/5.png 1200w,\n/static/5efa1ff72ed2828068a74bc96a6349b4/d9b5d/5.png 1224w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h1 id=\"duplicate-atom-key-waring\" style=\"position:relative;\"><a href=\"#duplicate-atom-key-waring\" aria-label=\"duplicate atom key waring permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Duplicate atom key Waring</h1>\n<p>동작에는 문제가 없지만 사실 next.js console에서는 Warning을 출력하고 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Duplicate atom key \"pageNameState\". This is a FATAL ERROR in\n      production. But it is safe to ignore this warning if it occurred because of\n      hot module replacement.</code></pre></div>\n<p>이는 SSR이라서 여러면 atom을 생성하면서 경고 메시지가 출력되는 것입니다.<br>\n현재 공식 <a href=\"https://github.com/facebookexperimental/Recoil/issues/733\">이슈</a>로 open 되어 있습니다. 수정까지는 시간이 꽤 걸릴 수 있으니 경고 창을 보고 싶지 않다! 라면 우회 방법을 알려드리도록 하겠습니다.</p>\n<h2 id=\"우회-방법\" style=\"position:relative;\"><a href=\"#%EC%9A%B0%ED%9A%8C-%EB%B0%A9%EB%B2%95\" aria-label=\"우회 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>우회 방법</h2>\n<p>되게 간단합니다. recoil module에서 해당 경고 메시지를 주석처리 하는 방법입니다.</p>\n<ol>\n<li><code class=\"language-text\">node_modules/recoil</code> 의 디렉터리에서 모든 <code class=\"language-text\">recoil.js</code> 파일의 <code class=\"language-text\">registerNode</code> 함수를 찾습니다.</li>\n<li>해당 함수를 잘 보시면 위에서 출력되는 경고 메시지를 출력해주는 함수입니다. <code class=\"language-text\">console.warn</code> 부분을 주석하면 더 이상 출력되지 않습니다.</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 637px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABtUlEQVQoz3WRWW7dMAxFvZcWSDyPz7Mtz4NsJwVaJO1P97+LW1J2XoAG7+PgkhLFSVpR/0RdvyOp35C2f1CNf9ENvxHFC56MEs9WRdR4MisF2+pM2dX9ntHtGlpYSlTiFzLxqogriXreUQwL8m5C1gy41VLdJfWOqBgohs7KAUU/U+xCOsFwa1VES6oN4/6K6ccBsWzojwOtXJE2M+JyRtkflIgSNhuKbqdEM8KMC0mkgotK5O0ON5pg+wO0WyHhRyv8eIUXzfBvC+kE0+1oDHHB1S/UeOLTN09ft0+0iBOGK1WY4YbMBCcY4YTjqYTptqQDLK+lLnrYZLPyHcczhiPUPlWHYbwjTHfqUiJINoUXLadPROlxf+jRBJbXX0XOgmczE513V4c0MgfyIVfmYL5k/bSbu8+/yd2w/o/qMOAdqt3xDlfY1IFuVzAo4AOV5EOt6iFakG9w4he4yQHrJmEE9CHhQjpDJ1unkQzarUU/yOPxT+qOuDoSX9DyUEAGOTqPcHO0Tqpo7OQixWjHMPQE354TfFekD9FEJvASppjc7M7ilxgpKTNRoc1NYKqE6ZXwMf8AXcdpj8Rc9B4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6\"\n        title=\"6\"\n        src=\"/static/f11b3b952382cfc54378b0e33b02b9ab/13a9a/6.png\"\n        srcset=\"/static/f11b3b952382cfc54378b0e33b02b9ab/5a46d/6.png 300w,\n/static/f11b3b952382cfc54378b0e33b02b9ab/0a47e/6.png 600w,\n/static/f11b3b952382cfc54378b0e33b02b9ab/13a9a/6.png 637w\"\n        sizes=\"(max-width: 637px) 100vw, 637px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<blockquote>\n<p>이 방법은 개인 에게만 적용되며 추천하지 않습니다.<br>\n실제로 key가 중복되는 경우를 구별할 수 없기 때문입니다.</p>\n</blockquote>\n<h1 id=\"비동기-작업은-어떻게\" style=\"position:relative;\"><a href=\"#%EB%B9%84%EB%8F%99%EA%B8%B0-%EC%9E%91%EC%97%85%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C\" aria-label=\"비동기 작업은 어떻게 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>비동기 작업은 어떻게?</h1>\n<p>이번에는 <code class=\"language-text\">selector</code> 함수를 이용하여 비동기 작업을 해보도록 하겠습니다.<br>\n<code class=\"language-text\">Ajax</code> 를 위해 저는 <code class=\"language-text\">axios</code> 즐겨 사용하기 때문에 해당 모듈을 설치하도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> i axios</code></pre></div>\n<p><code class=\"language-text\">/states/index.js</code> 에 아래의 코드를 추가합니다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> atom<span class=\"token punctuation\">,</span> selector <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span></span><span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageNameState <span class=\"token operator\">=</span> <span class=\"token function\">atom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">'pageNameState'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getNameSelector <span class=\"token operator\">=</span> <span class=\"token function\">selector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">'getNameSelector'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function-variable function\">get</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3000/api/hello'</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span>data</span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span></code></pre></div>\n<blockquote>\n<p><code class=\"language-text\">selector</code> 에서 반환되는 값은 필요한 값만 반환해야합니다.<br>\nCSR에서는 axios의 res 값을 모두 반환해서 사용해도 문제가 없었는데 next.js에서는 모두 반환하면 에러가 발생합니다.<br>\n아마 테스트 해보시면 비동기 콜을 하는 page를 다른 페이지에서 link를 통해 들어가면 문제가 없지만 해당 page 주소로 바로 접속하면 아래와 같은 에러가 출력되면서 next.js server가 down 됩니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 694px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABb0lEQVQoz3WS61KDMBCFeQq1tmChQLkkQMIdW9sqxeoP3/9tjruhXsYZf5w5m0C+3ezGSrMd2uEV/f4NTT+he7xAqid4QYXbZYK7VUoSfzzF7dVZC1vg3pHGLS+s4EcN/C2rNnrYKKx9DdcvsTFrfXVFiUqzH8Qtgmg+s1pn31DLjzukaoTUI4rqgkyfIYpniicTl+07+QTVXJDmz1T9C7ywJmCDkKBczPLhFzAMciSehpRngox06Ajb1aQSjlfB2XBlJL8hzfGCDv604+fKBthJhcYO0Q8fyPUTEjkgSnvKXGNNV3TpityWm/uYIDEBEgP4T9apHtC7WxTdiKodkZdHqnKHhIbFAxPFHpEYsE060zfHLb5lu7nRas0+ry0ZK8ROhKw8QeR7FATMaMoMVdXJKFMH8y0S/TzAaO4fJ+D/OBknDcmtUmjECw9CH9DvLuYJ1d3ZgLjiZpjMk+KYW8FgTpjIR9hU2VcP5ycl8AmQi/GC/oElTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"7\"\n        title=\"7\"\n        src=\"/static/c1a8ac345bddc8a23e4af352f64ef9b0/31198/7.png\"\n        srcset=\"/static/c1a8ac345bddc8a23e4af352f64ef9b0/5a46d/7.png 300w,\n/static/c1a8ac345bddc8a23e4af352f64ef9b0/0a47e/7.png 600w,\n/static/c1a8ac345bddc8a23e4af352f64ef9b0/31198/7.png 694w\"\n        sizes=\"(max-width: 694px) 100vw, 694px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\naxios 에서 return 데이터 중 <code class=\"language-text\">.data</code> 만을 사용하지 않고 모두 던지면 <code class=\"language-text\">selector</code> 호출 기록은 있지만 렌더링하다가 next.js에서 run time error 가 발생합니다.<br>\n해당 문제는 <code class=\"language-text\">npm run dev</code> 일 때만 발생합니다. 같은 코드인데 build 되어 start으로 실행 된 next.js server에서는 해당 문제가 발생하지 않습니다. 하지만 dev 환경의 live server가 되지 않기 때문에 전략적으로 필요한 데이터만 return 하여 사용하는 것이 좋아보입니다.</p>\n</blockquote>\n<p><code class=\"language-text\">/pages/post.js</code> 에 아래의 코드를 추가합니다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> Link <span class=\"token keyword\">from</span> <span class=\"token string\">'next/link'</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useRecoilState<span class=\"token punctuation\">,</span> useRecoilValueLoadable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> pageNameState<span class=\"token punctuation\">,</span> getNameSelector <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../states'</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">PostPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>pageName<span class=\"token punctuation\">,</span> setPageName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useRecoilState</span><span class=\"token punctuation\">(</span>pageNameState<span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> <span class=\"token function\">useRecoilValueLoadable</span><span class=\"token punctuation\">(</span>getNameSelector<span class=\"token punctuation\">)</span></span>  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'hasValue'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>Post Page<span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>pageName 상태<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>pageName<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>button\n              onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">setPageName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PostPage'</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">></span>\n              현재 페이지 이름으로 상태 변경\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n<span class=\"gatsby-highlight-code-line\">            <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span>contents<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span></span>          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Link href<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span><span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span>button<span class=\"token operator\">></span>Index Pages 이동<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'loading'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Loading<span class=\"token operator\">...</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'hasError'</span><span class=\"token operator\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>name<span class=\"token punctuation\">.</span>contents<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> PostPage</code></pre></div>\n<p><a href=\"https://ko.reactjs.org/docs/code-splitting.html#reactlazy\">SSR에서는 Suspense를 지원하지 않기 때문에</a> <code class=\"language-text\">useRecoilValueLoadable</code> 를 사용해야합니다.</p>\n<blockquote>\n<p>찾아보니 SSR에서도 Suspense 사용할 수 있는 방법이 있습니다! 나중에 시간이 될 때 소개하도록 하겠습니다.</p>\n</blockquote>\n<h2 id=\"테스트-결과-1\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B2%B0%EA%B3%BC-1\" aria-label=\"테스트 결과 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 결과</h2>\n<p>아래와 같이 정상적으로 렌더링 되는 것을 확인할 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAADQ0lEQVQ4y5WQXUibZxSAj6W96U23sbX+ZcbWRGtMk/TLn4k/MRJJMqMm2thIq7sIXrgtpYPilRjQhnmzi9UWLd7Um60flKL1olSUoaAiCk5aa+28EeO/SSaikM/3O3vf2Kbb2Jg98HDO+32c5xwOwNlMgAsyeFpVCr+8KILcb2zw0w99MPjsOYy8+BVe/vYa+J+fQLDtLjy49xC+v3UHjDoj5OUqIEOSA5lSOdxo8kN6Rhac++RzgDS5Cj5NlXCmy3lPruplj7Py5bzqCsdznJ7Xag28wWjiNVe1vFKp5tVqjs/PV/LZF3N4qfQiL/lSSsnmFQWqx+cvpMlyZJcBrO4mSM2UtpiVV1CnL8B8jRrNZgva7JVYYXehs9KNVpsT1VoT6gpLkNMVYp5ChbJcBVIR0iGoN5oxNTXdXVRSDoCIIJfnfWsstSJnKo6X2GxCmbVCUBuKBW1RmWAutwsGmtUqraBQcoLGVC5oDCWCWmcWPJ5rQl2NJ24wFqFEkuUNdvx4LNRodQG3vwktLV5iDfjE+usN6KhrwMIqFzq+vokN9O3hDFhbUYUWbwt+VXUdLWU2rHTViO5aL6mursXs7Ev193seHQvvhkKB5d+XcS28RpbfLovh8BqGw2GMRqL4RzSGMUokdkwssovRaIRC61hMjEajZGdnB9va2uqZKyEM0BgaGsKRkREyNjYm9vf3sxpPECKFsCIUCn0Q9vX1BXZ3d5FOInSiGIlEkh2EkH8goigmYUGOjo6ws7Pzg7C9vT1AN8OpqSlCERcXF5Gxubn572uJ4vssHs8kfxf29PQEtre3kW7G7iFubW0he7PbHBwc4P7+fjKz5vfS/xS2trYmNhweHib0luLc3BwuLCwgz/M4OjqKAwMDODg4iOPj48hO87/C7u7u7zY2NnB1dVVYWVkhe3t7hN0mHo+z+xBBEBL1u3uRvwb9dkT/Y0dHhzcp7O3tvb2+vo5MyvLh4SF+bHR1dfmSwmAwWDc/P/9mdnaWsTQ9Pb00MTGxNDk5eSJmZmZe+f3+8oTQ5XKlAMAXFD2ljGL5SFgPR/msubk5JbGhx+M55fP5Ttvt9jMOh+PEOJ3OM6ynsbHxtNVqTWGuPwE8jB0o/GZy3gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8\"\n        title=\"8\"\n        src=\"/static/b07ff330daa04aaf3c18118d4f458dec/c1b63/8.png\"\n        srcset=\"/static/b07ff330daa04aaf3c18118d4f458dec/5a46d/8.png 300w,\n/static/b07ff330daa04aaf3c18118d4f458dec/0a47e/8.png 600w,\n/static/b07ff330daa04aaf3c18118d4f458dec/c1b63/8.png 1200w,\n/static/b07ff330daa04aaf3c18118d4f458dec/d9b5d/8.png 1224w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<blockquote>\n<p>혹시라도 해당 api가 어디서 만들어 진건지? 하시면 기본 템플릿으로 만들면 생성되는 next.js api를 사용한 것입니다 😉</p>\n</blockquote>\n<h1 id=\"빌드-시-경고-창\" style=\"position:relative;\"><a href=\"#%EB%B9%8C%EB%93%9C-%EC%8B%9C-%EA%B2%BD%EA%B3%A0-%EC%B0%BD\" aria-label=\"빌드 시 경고 창 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>빌드 시 경고 창</h1>\n<p>자 이제 문제가 없는거 같지만 아직 한가지 더 남아있습니다…<br>\n한번 <code class=\"language-text\">npm run build</code> 으로 build를 해보시겟어요? 또 경고가 출력됩니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 764px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC30lEQVQ4y31U6W7aQBj0M1RtEsKNuW2MbbCNwdy3k1ByNT2kqpUaKQ9QtXn76TcbQFSN+mO0Zo/Z+b6ZRbu6e8TiwzMW9z8Rf3pG/PE3Vg+/8OV2ju+3IR4fBoiiEBWzi7rVQ67oIqu7SKRqSBYcNEc/sL55wtdvT7jYfIZWNkLYbh+Vmge97CKn2ygUbWSLHvKVEAVBud5DvdFDRfZWBSQuVn1kCzYy+QZOEhW8OSnjbaIKTfeWMJp9RKNLhNEafrhAp7dCy58ISRc1M0S+1EKh3Eah1FajXvFQEsJyvYOqKE/lbZxnGgpasRPDdEeKsDeIMZq+h+UMlIKiHCRZKtdUSGYtpPNNZEQZx7QQcZ4jwXnNjWKEky2i8RWmi2ss1ndoukOYdh+GFcFujWC3x7BkzhXVDXugSi/VAlREIdWyp6oCgebIgV5/LWUu0d+pbPlTtIMZouEF/O5CrXX7L+3ww7kizOqOGNSSKqR0IWc7SK6RgMoGkyvp4erwPZlvBdeKdDTdYL66RU++x7MtZssbdTnXh5ONWh9IhYvVHTRfbudhbtgr5CIPBrLGA5zjSNO4FnSpOFb7XW+iKmDfTTFX01sz1CQSgZTW7szQCqbKZfYulXsxIZl9MWTv5DE4T5wmDUEdGpuf3tm+d5PfnNd3LrvhAGXTU4e4lkib/+AQG8r0OvPdLfUDGlICc8bNwSyC6fk4PTdeVbkH92qO9IA95MgXQGUZeVJuMITVjtQmoyWZNFycpcz/EiqFzBKby6YTdJmhbjgRHH+sCEmU2JEdl3es7EBYk+e1jO9VoBmH6eJGBZZZdNoTITOkHa+Xd9y//agx3XSVKvcjXTeakQrsu/OaIj3d4Uz6eybmKIKd838p5EFmiUqZO/aSOaNCgt98ns3oElY3hhWuYI2uwbgVnAky8kISKePIZTGB75SE/GPgk6NShtmTZ8bfJA7lMubU6G9QH25R8pdIvlLyH9h8GH3ph/E/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9\"\n        title=\"9\"\n        src=\"/static/baccdc201875f9b853f8d8838e7d058f/f3c12/9.png\"\n        srcset=\"/static/baccdc201875f9b853f8d8838e7d058f/5a46d/9.png 300w,\n/static/baccdc201875f9b853f8d8838e7d058f/0a47e/9.png 600w,\n/static/baccdc201875f9b853f8d8838e7d058f/f3c12/9.png 764w\"\n        sizes=\"(max-width: 764px) 100vw, 764px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>build 시점에 <code class=\"language-text\">selector</code> 에서 호출하는 api가 정상이 아니면 에러가 발생합니다.</p>\n<blockquote>\n<p>더 정확히 말하면 try 부분의 코드를 실행하는거 같습니다. 해당 부분에 <code class=\"language-text\">console.log</code> 와 같은 코드를 삽입하면 출력되는 것을 확인할 수 있습니다.</p>\n</blockquote>\n<p>우리는 next.js의 api를 사용하고 있기 때문에 build 시점에 next.js server가 내려가 있으니 api에 호출에 실패에서 발생하는 메시지 입니다.</p>\n<p>아래와 같이 해당 부분을 trycatch으로 묶는다면 catch에 걸리는 것을 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> atom<span class=\"token punctuation\">,</span> selector <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span>\n<span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> pageNameState <span class=\"token operator\">=</span> <span class=\"token function\">atom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">'pageNameState'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getNameSelector <span class=\"token operator\">=</span> <span class=\"token function\">selector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">'getNameSelector'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">get</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span></span>      <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:3000/api/hello'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span>data\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">getNameSelector 에러 발생</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></span>    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 659px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACZUlEQVQ4y3VUa3eaQBT0RzSNURR5KbA8xQcgCBiTaI15n/ZL+/9/xvTexdT0tPkw5+5yYHbu3Fk6mpPBsJdw/ByWs4Q+nmFkTmUd6nG7tmbQqBr0jJ+bk7mEZS8wpm9skcH2cozdFB0zO0AXK2yuH7BujhJFdUC1ecAyv4MXFhDRGiqRDswEQwatuRpE+g6TyPmwjpXuYQRrlESQl3tJVBO5ICKNP6IXPXuG0Iog9ACu5kvwuqcIXPZdwrl2jOUeVtwgq48o63ts714kYXU6YEKtTJ0EdZRh5S+QugmWzhQ51aEa4Grgozc8o2PHtZQ/IS/Yg8kJ7IkXllCNGH0tku2OxnNcDgNckLILxSMyT5K8V0koghVcAm9YdnfQvvilayOYVgiTCooawo1SNMctDFLXpdb6J4KPZK1CUsKD8Mn4vnoiPXnDzzzCZU/AFDHWxwq6HUuvPpL8RchxWeS3mKc3UqkXlRBBAZUi489WSPI1enTQQA/hxHOq5JvifU7Io86KPTY3z3Ig17dt5RjwYWlxB5UyKCdJSv/n2z+EnLtm+0TTfZTgPQeXW05XO/IwkC+zJZ8p+0PINyEvv2F//wM3u1dS+kQqX+SEQxrKdL7B154jB9ElX68UV1b2ud2LM0g1ESY0yRp+vEZElQmiWSPBXjKx7WWY+CtodAFGXgkjrKUlJu1VN8coqKB5RauQB8Htcva43d3hOwoKOCtlXzkBzfYRDa3L7TOa3RtyugSLw0/MDr/g1K/QiFTRpy1hn/zhC84bOQiKkTydMBFtyOV9Pf0U+EegW4lUNRStaoWCz+0zx2+cuq3CA0HhuAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"10\"\n        title=\"10\"\n        src=\"/static/f92434061c0984b6966851fd20e31778/6db71/10.png\"\n        srcset=\"/static/f92434061c0984b6966851fd20e31778/5a46d/10.png 300w,\n/static/f92434061c0984b6966851fd20e31778/0a47e/10.png 600w,\n/static/f92434061c0984b6966851fd20e31778/6db71/10.png 659w\"\n        sizes=\"(max-width: 659px) 100vw, 659px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>결론적으로 경고 메시지가 출력되어도, catch에 걸리더라도 <strong>구어진 정적파일은 문제가 없으며 next.js server가 실행했을 때 정상적으로 동작합니다.</strong></p>\n<p><code class=\"language-text\">selector</code> get부분에 api EndPoint를 next.js 내부 api 말고 build 시점에 살아있는 api으로 호출한다면 경고 메시지 없이 빌드 되는 것을 확인할 수 있습니다.</p>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<p>사용하는데 크게 어려운 점은 없지만 비동기 콜 부분에서 많은 시간을 소비하였습니다.</p>\n<p>에러 발생 시 정보가 생각보다 디테일 하지 않았고 CSR에서는 되던건게 안되서 코드를 잘못짠건가?🧐 했습니다.</p>\n<p>특히 axios 결과 값을 모두 return 했을 때 next.js server가 down되는 부분에서 많은 시간을 소비하였습니다.</p>\n<p>어서 recoil이 공식 릴리즈되서 많은 사람들이 사용했으면 좋겠네요 언제든지 질문과 피드백은 환영합니다. 읽어주셔서 감사합니다.</p>","frontmatter":{"title":"next.js에서 recoil 사용하기","date":"May 06, 2021"}}},"pageContext":{"slug":"/next.js/using-recoil-in-next.js/","previous":{"fields":{"slug":"/essay/2020-retrospective/"},"frontmatter":{"title":"parkgang.log(2020)","category":"essay","draft":false}},"next":{"fields":{"slug":"/devops/workflows-with-aks-github-slack-1/"},"frontmatter":{"title":"aks, github, slack으로 워크플로우 구축하기 - 1편 (소개) 🔥","category":"devops","draft":false}}}},"staticQueryHashes":["2486386679","3128451518"]}